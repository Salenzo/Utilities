<!DOCTYPE html>
<meta charset="utf-8">
<title>crontab</title>
<style>
*, *::before, *::after {
  box-sizing: border-box;
}
::selection {
  background-color: rgba(255, 255, 128, .2);
}
html {
  color: #cccccc;
  background-color: #1a1a1a;
  text-align: center;
  font-family: "Courier New", Courier, monospace;
  font-size: 1.3em;
}
body {
  max-width: 900px;
  margin: auto;
  padding: 0 1em;
}
table {
  margin-left: auto;
  margin-right: auto;
  border-collapse: collapse;
  border-top: 1px solid #333333;
  border-bottom: 1px solid #333333;
  width: 100%;
  max-width: 400px;
}
th, td {
  border-top: 1px solid #333333;
  border-bottom: 1px solid #333333;
}
th {
  width: 13em;
  text-align: right;
  padding: .2em 1em .2em 0;
}
td {
  text-align: left;
  padding: .2em 0 .2em 1em;
}
#warningDiv {
  color: saddlebrown;
  font-size: 75%;
}
#input {
  font-family: "Courier New", Courier, monospace;
  text-align: center;
  font-size: 250%;
  width: 100%;
  background-color: #333333;
  border: 1px solid #cccccc;
  border-radius: .6em;
  color: #ffffff;
  padding-top: .075rem;
}
#input.invalid {
  border: 1px solid darkred;
}
#input.warning {
  border: 1px solid saddlebrown;
}
#input:focus {
  outline: none;
}
#input::selection {
  color: #ffff80;
  background-color: rgba(255, 255, 128, .2);
}
.clickable {
  text-decoration: underline;
  cursor: pointer;
  user-select: none;
}
.part-explanation {
  font-size: 75%;
  color: #a8a8a8;
  height: 24em;
}
.part-explanation div {
  display: inline-block;
  vertical-align: top;
}
.part-explanation .active {
  color: #ffff80;
}
.part-explanation .invalid {
  background-color: darkred;
}
.part-explanation .warning {
  background-color: saddlebrown;
}
.part-explanation .clickable {
  border-radius: 1em;
  padding: .1em .36em;
}
.human-readable {
  font-size: 200%;
  font-family: Georgia, serif;
  min-height: 2.2em;
  margin-bottom: .2em;
  margin-top: .9em;
}
.human-readable .active {
  color: #ffff80;
}
.next-date {
  font-size: 75%;
}
.example {
  font-size: 75%;
}
@media screen and (max-width: 480px) {
  #input {
    font-size: 200%;
  }
  .part-explanation .clickable {
    padding: .1em .01em;
    margin: 0 .1em 0 .1em;
  }
  table {
    max-width: 360px;
  }
  table th {
    width: 7em;
  }
}
</style>

<div id="content"><!--+--></div>
<div id="hr" class="human-readable"></div>
<div id=anotherDiv class="next-date"></div>
<div id=randomDiv class="example clickable">random</div>
<div class="text-editor"><input id="input" autocomplete="off" class="warning" value="5 4 * * SUN-mon"></div>
<div id="warningDiv">Non standard! May not work with every cron.</div>
<div id=partExpDiv class="part-explanation">
  <div class="cron-parts">
    <div>minute</div>
    <div>hour</div>
    <div>day<br>(month)</div>
    <div>month</div>
    <div>day<br>(week)</div>
  </div>
  <table>
    <tbody>
      <tr><th>*</th><td>any value</td></tr>
      <tr><th>,</th><td>value list separator</td></tr>
      <tr><th>-</th><td>range of values</td></tr>
      <tr><th>/</th><td>step values</td></tr>
    </tbody>
    <tbody>
      <tr><th>@yearly</th><td>(non-standard)</td></tr>
      <tr><th>@annually</th><td>(non-standard)</td></tr>
      <tr><th>@monthly</th><td>(non-standard)</td></tr>
      <tr><th>@weekly</th><td>(non-standard)</td></tr>
      <tr><th>@daily</th><td>(non-standard)</td></tr>
      <tr><th>@hourly</th><td>(non-standard)</td></tr>
      <tr><th>@reboot</th><td>(non-standard)</td></tr>
    </tbody>
    <tbody>
      <tr><th>0-59</th><td>allowed values</td></tr>
    </tbody>
    <tbody>
      <tr><th>0-23</th><td>allowed values</td></tr>
    </tbody>
    <tbody>
      <tr><th>1-31</th><td>allowed values</td></tr>
    </tbody>
    <tbody>
      <tr><th>1-12</th><td>allowed values</td></tr>
      <tr><th>JAN-DEC</th><td>alternative single values</td></tr>
    </tbody>
    <tbody>
      <tr><th>0-6</th><td>allowed values</td></tr>
      <tr><th>SUN-SAT</th><td>alternative single values</td></tr>
      <tr><th>7</th><td>sunday (non-standard)</td></tr>
    </tbody>
  </table>
</div>

<script>
// bug in original: 5 4 */4 3-3/1 SUN

function appendChildModule(parent, children) {
	for (var i = 0; i < children.length; i++) {
		if (Array.isArray(children[i])) {
			appendChildModule(parent, children[i]);
		} else {
			if ("number" == typeof children[i] || "boolean" == typeof children[i] || children[i] instanceof Date || children[i] instanceof RegExp) children[i] = children[i].toString();
			if ("string" == typeof children[i]) children[i] = document.createTextNode(children[i]);
			if (children[i] && children[i].nodeType) parent.appendChild(children[i]);
		}
	}
}

var exampleobj = {
	"/every-minute": "* * * * *",
	"/every-1-minute": "* * * * *",
	"/every-2-minutes": "*/2 * * * *",
	"/every-even-minute": "*/2 * * * *",
	"/every-uneven-minute": "1-59/2 * * * *",
	"/every-3-minutes": "*/3 * * * *",
	"/every-4-minutes": "*/4 * * * *",
	"/every-5-minutes": "*/5 * * * *",
	"/every-five-minutes": "*/5 * * * *",
	"/every-6-minutes": "*/6 * * * *",
	"/every-10-minutes": "*/10 * * * *",
	"/every-ten-minutes": "*/10 * * * *",
	"/every-15-minutes": "*/15 * * * *",
	"/every-fifteen-minutes": "*/15 * * * *",
	"/every-quarter-hour": "*/15 * * * *",
	"/every-20-minutes": "*/20 * * * *",
	"/every-30-minutes": "*/30 * * * *",
	"/every-hour-at-30-minutes": "30 * * * *",
	"/every-half-hour": "*/30 * * * *",
	"/every-60-minutes": "0 * * * *",
	"/every-hour": "0 * * * *",
	"/every-1-hour": "0 * * * *",
	"/every-2-hours": "0 */2 * * *",
	"/every-two-hours": "0 */2 * * *",
	"/every-even-hour": "0 */2 * * *",
	"/every-other-hour": "0 */2 * * *",
	"/every-3-hours": "0 */3 * * *",
	"/every-three-hours": "0 */3 * * *",
	"/every-4-hours": "0 */4 * * *",
	"/every-6-hours": "0 */6 * * *",
	"/every-six-hours": "0 */6 * * *",
	"/every-8-hours": "0 */8 * * *",
	"/every-12-hours": "0 */12 * * *",
	"/hour-range": "0 9-17 * * *",
	"/between-certain-hours": "0 9-17 * * *",
	"/every-day": "0 0 * * *",
	"/daily": "0 0 * * *",
	"/once-a-day": "0 0 * * *",
	"/every-night": "0 0 * * *",
	"/every-day-at-1am": "0 1 * * *",
	"/every-day-at-2am": "0 2 * * *",
	"/every-day-8am": "0 8 * * *",
	"/every-morning": "0 9 * * *",
	"/every-midnight": "0 0 * * *",
	"/every-day-at-midnight": "0 0 * * *",
	"/every-night-at-midnight": "0 0 * * *",
	"/every-sunday": "0 0 * * SUN",
	"/every-monday": "0 0 * * MON",
	"/every-tuesday": "0 0 * * TUE",
	"/every-wednesday": "0 0 * * WED",
	"/every-thursday": "0 0 * * THU",
	"/every-friday": "0 0 * * FRI",
	"/every-friday-at-midnight": "0 0 * * FRI",
	"/every-saturday": "0 0 * * SAT",
	"/every-weekday": "0 0 * * 1-5",
	"/weekdays-only": "0 0 * * 1-5",
	"/monday-to-friday": "0 0 * * 1-5",
	"/every-weekend": "0 0 * * 6,0",
	"/weekends-only": "0 0 * * 6,0",
	"/every-7-days": "0 0 * * 0",
	"/weekly": "0 0 * * 0",
	"/once-a-week": "0 0 * * 0",
	"/every-week": "0 0 * * 0",
	"/every-month": "0 0 1 * *",
	"/monthly": "0 0 1 * *",
	"/once-a-month": "0 0 1 * *",
	"/every-other-month": "0 0 1 */2 *",
	"/every-quarter": "0 0 1 */3 *",
	"/every-6-months": "0 0 1 */6 *",
	"/every-year": "0 0 1 1 *"
};
function ordinal(str) {
	var num = parseInt(str);
	return str + ([undefined, "st", "nd", "rd"][num > 20 ? num % 10 : num] || "th");
}
function padZero2(e) {
	return ("0" + e).slice(-2)
}
function describe_strings(list) {
	switch (list.length) {
		case 0: return "";
		case 1: return list[0];
		case 2: return list[0] + " and " + list[1];
		default: return list.slice(0, list.length - 1).join(", ") + ", and " + list[list.length - 1]
	}
}
function func_p(e, t, n, r, o) {
	return ((o ? "" : t + " ") + describe_strings(e.split(",").map(function (e) {
		if (e === "*") return "every " + t;
		var o = e.match(/\d+|./g).map(function (e) {
			return isNaN(Number(e)) ? e : Number(e)
		}), a = o[0];
		if (Number.isInteger(a)) {
			if (o.length == 1) {
				return "" + (n[a] || a);
			} else if (o.length == 3 && "/" === o[1] && Number.isInteger(o[2])) {
				return "every " + ordinal(o[2]) + " " + t + " from " + (n[a] || a) + " through " + (n[r] || r);
			} else if (o.length == 3 && "-" === o[1] && Number.isInteger(o[2]) && o[2] >= a) {
				return "every " + t + " from " + (n[a] || a) + " through " + (n[o[2]] || o[2]);
			} else if (o.length == 5 && "-" === o[1] && Number.isInteger(o[2]) && o[2] >= a && "/" === o[3] && Number.isInteger(o[4]) && 1 <= o[4]) {
				return "every " + ordinal(o[4]) + " " + t + " from " + (n[a] || a) + " through " + (n[o[2]] || o[2]);
			}
		} else if (3 === o.length && "/" === o[1] && Number.isInteger(o[2]) && "*" === o[0]) {
			return "every " + ordinal(o[2]) + " " + t;
		}
		return "";
	}))).replace("every 1st", "every").replace(t + " every", "every").replace(", " + t, ", ").replace(", and " + t, ", and ")
}
var TWO_DIGITS = /^0*\d\d?$/;
var indexmodule = {};
indexmodule.describe = function (e) {
	if ("@reboot" === e.originalParts[0]) return {
		full: "After rebooting.",
		special: "After rebooting.",
	};
	var part0, part1, part2, part3 = e.parts;
	var dates = "*" === (part2 = part3[2]) ? "" : "on " + func_p(part2, "day-of-month", {}, 31);
	var months = "*" === (part1 = part3[3]) ? "" : "in " + func_p(part1, "month", [null, "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"], 12, true);
	var weekdays = "*" === (part0 = part3[4]) ? "" : "on " + func_p(part0, "day-of-week", ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"], 7, true);
	var datesWeekdays = dates && weekdays ? (e.daysAnded ? "if it's" : "and") : "";
	if (TWO_DIGITS.test(part3[0]) && TWO_DIGITS.test(part3[1])) {
		var d = [padZero2(part3[0]), padZero2(part3[1])];
		return {
			start: "At",
			minutes: d[0],
			hours: d[1],
			isTime: true,
			dates: dates || null,
			datesWeekdays: datesWeekdays || null,
			weekdays: weekdays || null,
			months: months || null,
			end: ".",
			full: ("At " + d[1] + ":" + d[0] + " " + dates + " " + datesWeekdays + " " + weekdays + " " + months).replace(/ +/g, " ").trim() + "."
		};
	}
	var m = part3[1], minutes = func_p(part3[0], "minute", {}, 59);
	var hours = "*" === m ? "" : "past " + func_p(m, "hour", {}, 23);
	return {
		start: "At",
		minutes: minutes || null,
		hours: hours || null,
		dates: dates || null,
		datesWeekdays: datesWeekdays || null,
		weekdays: weekdays || null,
		months: months || null,
		end: ".",
		full: ("At " + minutes + " " + hours + " " + dates + " " + datesWeekdays + " " + weekdays + " " + months).replace(/ +/g, " ").trim() + ".",
	}
}

function substituteStringValue(e, i) {
	return Object.keys(i).reduce(function (e, t) {
		var from = new RegExp("(^|[ ,-/])" + t + "($|[ ,-/])", "gi");
		var to = "$1" + i[t] + "$2";
		return e.replace(from, to).replace(from, to);
	}, e)
}
indexmodule.prenormalize = function (e) {
	var t = e.trim().split(/\s+/).filter(e => e);
	if (t.length == 1 && "@reboot" === t[0]) return {
		originalParts: t,
		parts: []
	};
	var o = (t.length == 1 ? ({
		"@yearly": ["0", "0", "1", "1", "*"],
		"@annually": ["0", "0", "1", "1", "*"],
		"@monthly": ["0", "0", "1", "*", "*"],
		"@weekly": ["0", "0", "*", "*", "0"],
		"@daily": ["0", "0", "*", "*", "*"],
		"@midnight": ["0", "0", "*", "*", "*"],
		"@hourly": ["0", "*", "*", "*", "*"]
	}[t[0]] || [t[0]]) : t).map(function (e, t) {
		switch (t) {
			case 3: return substituteStringValue(e, {jan: "1", feb: "2", mar: "3", apr: "4", may: "5", jun: "6", jul: "7", aug: "8", sep: "9", oct: "10", nov: "11", dec: "12"});
			case 4: return substituteStringValue(e, {sun: "0", mon: "1", tue: "2", wed: "3", thu: "4", fri: "5", sat: "6"});
			default: return e;
		}
	});
	return {
		originalParts: t,
		parts: o,
		daysAnded: !!o[2] && "*" === o[2][0] || !!o[4] && "*" === o[4][0]
	}
}

function uniq(e) {
	return e.reduce(function (e, t) {
		if (e.indexOf(t) < 0) e.push(t);
		return e;
	}, []);
}
function linspaceLike(start, stop, step) {
	var r = [];
	for (var i = start; i <= stop; i += step) r.push(i);
	return r;
}
function func_y(e, t) {
	var from = /(^|[,-/])\*($|[,-/])/g;
	var to = "$1" + t + "$2";
	return e.replace(from, to).replace(from, to)
}
function func_g(e, t) {
	var n = e.split(",").map(function (e) {
		return function (e, t) {
			var n = ((e || "").match(/\d+|./g) || []).map(function (e) {
				var t = Number(e);
				return isNaN(t) ? e : t
			})
			var r = n[0];
			if (Number.isInteger(r)) {
				if (n.length == 1) return {
					list: [r]
				};
				if (n.length == 3 && "/" === n[1] && Number.isInteger(n[2]) && 1 <= n[2]) return {
					list: linspaceLike(r, t, n[2]),
					warnings: ["nonstandard"]
				};
				if (3 === n.length && "-" === n[1] && Number.isInteger(n[2]) && n[2] >= r) return {
					list: linspaceLike(r, n[2], 1)
				};
				if (5 === n.length && "-" === n[1] && Number.isInteger(n[2]) && n[2] >= r && "/" === n[3] && Number.isInteger(n[4]) && 1 <= n[4]) return {
					list: linspaceLike(r, n[2], n[4])
				}
			}
			return {
				errors: ["invalid part"],
			}
		}(e, t)
	});
	return {
		list: uniq(n.map(e => e.list || []).flat()).sort((a, b) => a - b).filter(e => !isNaN(e)),
		errors: uniq(n.map(e => e.errors || []).flat()),
		warnings: uniq(n.map(e => e.warnings || []).flat()),
	}
}
function in_range(e, t, n) {
	return e.length && (e[0] < t || e[e.length - 1] > n)
}
var validCharacters = /[^\d\-\/\,]/i;
indexmodule.normalize = function (e) {
	var t = e.parts.map(function (e) {
		return e.slice(0)
	}).map(function (e) {
		return e.replace(/\*\/1(?!\d)/g, "*")
	});
	if (t.length == 0 && e.originalParts.length) return {};
	var result = {
		errors: [],
		warnings: [],
	};
	if (e.daysAnded !== undefined) result.daysAnded = e.daysAnded;
	if (t.length != 5) result.errors.push("fields");
	if (t[0] && t[0].length) {
		var r = func_y(t[0], "0-59")
			, o = func_g(r, 59);
		result.minutes = o.list,
			(o.errors.length || in_range(result.minutes, 0, 59) || validCharacters.test(r)) && (result.minutes = [],
				result.errors.push("minutes")),
			o.warnings.length && result.warnings.push("minutes")
	} else
		undefined === t[0] && result.errors.push("minutes");
	if (t[1] && t[1].length) {
		var a = func_y(t[1], "0-23")
			, u = func_g(a, 23);
		result.hours = u.list,
			(u.errors.length || in_range(result.hours, 0, 23) || validCharacters.test(a)) && (result.hours = [],
				result.errors.push("hours")),
			u.warnings.length && result.warnings.push("hours")
	} else
		undefined === t[1] && result.errors.push("hours");
	if (t[2] && t[2].length) {
		var i = func_y(t[2], "1-31")
			, s = func_g(i, 31);
		result.dates = s.list,
			(s.errors.length || in_range(result.dates, 1, 31) || validCharacters.test(i)) && (result.dates = [],
				result.errors.push("dates")),
			s.warnings.length && result.warnings.push("dates")
	} else
		undefined === t[2] && result.errors.push("dates");
	if (t[3] && t[3].length) {
		var c = func_y(t[3], "1-12")
			, l = e.originalParts[3]
			, d = func_g(c, 12);
		result.months = d.list,
			(d.errors.length || in_range(result.months, 1, 12) || validCharacters.test(c)) && (result.months = [],
				result.errors.push("months")),
			(d.warnings.length || l && t[3] !== l && 3 < l.length && /\D/.test(l)) && result.warnings.push("months")
	} else
		undefined === t[3] && result.errors.push("months");
	if (t[4] && t[4].length) {
		var m = func_y(t[4], "0-6")
			, f = e.originalParts[4]
			, h = func_g(m, 7);
		result.weekdays = uniq(h.list.map(function (e) {
			return 7 === e ? 0 : e
		})).sort((a, b) => a - b),
			(h.errors.length || in_range(result.weekdays, 0, 6) || validCharacters.test(m)) && (result.weekdays = [],
				result.errors.push("weekdays")),
			(h.warnings.length || h.list.includes(7) || f && t[4] !== f && 3 < f.length && /\D/.test(f)) && result.warnings.push("weekdays")
	} else
		undefined === t[4] && result.errors.push("weekdays");
	result.errors.length || delete result.errors;
	result.warnings.length || delete result.warnings;
	return result;
};

indexmodule.nextDate = function (schedule, time) {
	if (!(Object.keys(schedule).length && schedule.months.length && schedule.dates.length && schedule.weekdays.length && schedule.hours.length && schedule.minutes.length)) return null;

	var utcMilliseconds = time.getUTCMilliseconds();
	if (utcMilliseconds != 0) time = new Date(time.getTime() + (1000 - utcMilliseconds));
	var utcSeconds = time.getUTCSeconds();
	if (utcSeconds != 0) time = new Date(time.getTime() + 1000 * (60 - utcSeconds));

	for (var depth = 1; depth < 1280; depth++) {
		var month = time.getUTCMonth() + 1;
		var year = time.getUTCFullYear();
		if (!schedule.months.includes(month)) {
			time = new Date(Date.UTC(year, month + 1 - 1, 1, 0, 0));
			continue;
		}
		var date = time.getUTCDate();
		var s = schedule.dates.includes(date);
		var c = schedule.weekdays.includes(time.getUTCDay());
		if (schedule.daysAnded && (!s || !c) || !schedule.daysAnded && !s && !c) {
			time = new Date(Date.UTC(year, month - 1, date + 1, 0, 0));
			continue;
		}
		var hour = time.getUTCHours();
		if (!schedule.hours.includes(hour)) {
			time = new Date(Date.UTC(year, month - 1, date, hour + 1, 0));
			continue;
		}
		var minute = time.getUTCMinutes();
		if (!schedule.minutes.includes(minute)) {
			time = new Date(Date.UTC(year, month - 1, date, hour, minute + 1));
			continue;
		}
		return time;
	}
	console.log("找一百年都找不到触发的日子（恼");
	return null;
};

setTimeout(function () {
	e("setNextMinute", new Date, t);
	setInterval(function () {
		e("setNextMinute", new Date, t);
	}, 60000);
}, 1000 * (61 - new Date().getUTCSeconds()));















function choo() {
	// barracks
	var barC = function (e, t, n, r, o, a) {
		e.forEach(function (e) {
			e(t, n, r, o, a)
		})
	};
	function barN(n, r, o, a) {
		n && !o[n] && (o[n] = {});
			Object.keys(r).forEach(function (e) {
				var t = a ? a(r[e], e) : r[e];
				n ? o[n][e] = t : o[e] = t
			})
	}
	function barT(t, e) {
		e.forEach(function (e) {
			t = e(t)
		})
		return t
	}
	var thatStor = m._store = function (e) {
		var p = []
			, v = []
			, tgui = [function () {
				return function (e) { if (e) throw e; }
			}]
			, s = []
			, a = []
		t(e = e || {});
		var hasReducer = false
			, hasStatee = false
			, g = n._reducers = {}
			, w = n._models = []
			, x = {};
		n.model = function (e) {
			w.push(e)
		}
			n.state = function (e) {
				var r = (e = e || {}).state;
				if (!e.state && false === e.freeze)
					return Object.assign({}, x);
				if (!e.state)
					return Object.freeze(Object.assign({}, x));
				var o = []
					, a = {};
				w.forEach(function (e) {
					var t = e.namespace;
					o.push(t);
					var n = e.state || {};
					t ? (a[t] = a[t] || {},
						barN(t, n, a),
						a[t] = Object.assign({}, a[t], r[t])) : Object.assign(a, n)
				}),
					Object.keys(r).forEach(function (e) {
						-1 === o.indexOf(e) && (a[e] = r[e])
					});
				return Object.freeze(barT(Object.assign({}, x, r, a), s))
			}
			n.start = n
			n.use = t
			return n;
		function t(e) {
			e.onStateChange && p.push(e.onStateChange)
		}
		function n(n) {
			n = n || {};
				w.forEach(function (e) {
					var r = e.namespace;
					if (!hasStatee && e.state && false !== n.state) {
						var t = e.state || {};
						r ? (x[r] = x[r] || {},
							barN(r, t, x)) : Object.assign(x, t)
					}
					!hasReducer && e.reducers && false !== n.reducers && barN(r, e.reducers, g, function (e) {
						return barT(e, a)
					})
				})
				hasStatee || false === n.state || (x = barT(x, s));
				n.noReducers || (hasReducer = true);
				n.noState || (hasStatee = true)
			return h;
			function h(o, a) {
				return function (e, t, n) {
					n || a || (n = t,
						t = null);
					var r = a ? function (e) {
						(e = e || null) && barC(tgui, e, x, function (n) {
							return function (e, t) {
								u(e, t = undefined === t ? null : t, n, r)
							}
						})
					}
						: n;
					u(e, t = undefined === t ? null : t, o, r)
				}
			}
			function u(actionName, d, m, f) {
				setTimeout(function () {
					var n = Object.assign({}, x);
					v.length && barC(v, d, x, actionName, m, h);
					Object.assign(n, g[actionName](d, x));
					p.length && barC(p, d, n, x, actionName, h)
					f(null, x = n)
				}, 0)
			}
		}
	}()
	var thisRouter = m._router = null
	var i = null
	thatStor.use({
		onStateChange: function (e, t, n) {
			 thisRouter("", t, n);
		}
	});
	m.toString = function (e, t) {
		t = t || {},
			thatStor.start({
				reducers: false,
			});
		var n = thatStor.state({
			state: t
		})
		var r = f(i, null, function () {
			return function () { }
		})(e, n);
		return r.outerHTML || r.toString()
	},
		m.router = function (e) {
			i = e;
		},
		m.model = function (e) {
			thatStor.model(e)
		};
	m.start = m;
	m.use = function (e) {
		thatStor.use(e)
	};
	return m;
	function m(startingState) {
		thatStor.model(function () {
			return {
				namespace: "location",
				reducers: {
					setLocation: function (e, t) {
						return {
							pathname: e.location.replace(/#.*/, "")
						}
					}
				},
				state: {
					pathname: location.href
				}
			};
		}(startingState));
		var t = thatStor.start(startingState);
		thisRouter = m._router = f(i, null, t);
		var r = thatStor.state({
			state: {}
		});
		var o = thisRouter(r.location.pathname, r);
		return c = o
	}
	function f(e, t, u) {
		var i = {
			params: {}
		};
		return function (e, param1, n) {
			var uxy = e(n((e, t, n) => ["", null, t]))[0][2];
			return function (x, y, z) {
				return uxy(x, y, z)
			}
		}(e, t, function (r) {
			return function (e, t, n) {
				var o, a
				"function" == typeof t && (o = t,
					a = u("view: " + e, true),
					t = function (e, t) {
						var n = i
						var r = i = Object.assign({}, t, { params: e });
						Object.freeze(r)
						return o(r, n, a)
					}
				);
				return r(e, t, n);
			}
		})
	}
}
















var randomExamplesArray = [
	"5 0 * 8 *",
	"15 14 1 * *", "0 22 * * 1-5", "23 0-20/2 * * *", "5 4 * * sun", "0 0,12 1 */2 *", "0 4 8-14 * *", "0 0 1,15 * 3", "@weekly"]
	, normalizeSpace = function (e) {
		return e.trim().replace(/ +/g, " ")
	};
function veryPreNorm(text) {
	text = normalizeSpace(text)
	var prenormalized = indexmodule.prenormalize(text)
	var schedule = indexmodule.normalize(prenormalized)
	var description = schedule.errors ? null : indexmodule.describe(prenormalized);
	return {
		schedule: schedule,
		description: description,
		isSpecialString: text.startsWith("@")
	}
}
var insideText = "5 4 * * *", veryPNText = veryPreNorm(insideText);

var app = choo();
app.model({
	state: {
		text: insideText,
		schedule: veryPNText.schedule,
		description: veryPNText.description,
		exampleIndex: 0,
		selectedPart: null,
		selectedDirectly: false,
		isSpecialString: veryPNText.isSpecialString,
		date: new Date,
		focussed: false,
	},
	reducers: {
		showNextExample: function (e, t) {
			var n = randomExamplesArray[t.exampleIndex]
				, r = veryPreNorm(n);
			return {
				text: n,
				schedule: r.schedule,
				description: r.description,
				exampleIndex: (t.exampleIndex + 1) % randomExamplesArray.length,
				isSpecialString: r.isSpecialString
			}
		},
		inputFocus: function (e, t) {
			return { focussed: true }
		},
		inputBlur: function (e, t) {
			return {
				text: normalizeSpace(t.text),
				selectedPart: null,
				focussed: false
			}
		},
		selectPart: function (e, t) {
			return {
				selectedPart: t.isSpecialString ? null : e,
				selectedDirectly: false
			}
		},
		inputUpdate: function (e, t) {
			return { text: e }
		},
		inputEnter: function (e, t) {
			return veryPreNorm(e)
		},
		inputSelect: function (e, t) {
			if (!t.focussed) return {};
			if (t.isSpecialString) return {
				selectedPart: null,
				selectedDirectly: true
			};
			var o = normalizeSpace(t.text.substring(0, e.selectionStart + 1)).split(" ").length;
			return {
				selectedPart: o === normalizeSpace(t.text.substring(0, e.selectionEnd + 1)).split(" ").length ? Math.max(Math.min(o, 5), 1) : null,
				selectedDirectly: true
			}
		},
		setNextMinute: function (e, t) {
			return { date: e }
		}
	},
})
app.router(function (e) {
	return [e("/", function (state, prevState, takeAction) {
		// human readable
		function activeClass(part, t) {
			return t.selectedPart === part ? "active" : ""
		}
		hr.innerHTML = ""
		if (state.description) {
			var humanDesc = state.description;
			var span2 = document.createElement("span");
			span2.setAttribute("class", activeClass(1, state));
			appendChildModule(span2, [humanDesc.minutes]);
			var span3 = document.createElement("span");
			span3.setAttribute("class", activeClass(2, state));
			appendChildModule(span3, [humanDesc.hours]);
			var span4 = document.createElement("span");
			span4.setAttribute("class", activeClass(3, state));
			appendChildModule(span4, [humanDesc.dates]);
			var span5 = document.createElement("span");
			appendChildModule(span5, [humanDesc.datesWeekdays]);
			var span6 = document.createElement("span");
			span6.setAttribute("class", activeClass(5, state));
			appendChildModule(span6, [humanDesc.weekdays]);
			var span7 = document.createElement("span");
			span7.setAttribute("class", activeClass(4, state));
			appendChildModule(span7, [humanDesc.months]);

			if (humanDesc.special) {
				hr.textContent = humanDesc.special;
			} else if (humanDesc.isTime) {
				appendChildModule(hr, [humanDesc.start, " ", span3, ":", span2, humanDesc.dates ? " " : "", span4, humanDesc.datesWeekdays ? " " : "", span5, humanDesc.weekdays ? " " : "", span6, humanDesc.months ? " " : "", span7, humanDesc.end]);
			} else {
				appendChildModule(hr, [humanDesc.start, humanDesc.minutes ? " " : "", span2, humanDesc.hours ? " " : "", span3, humanDesc.dates ? " " : "", span4, humanDesc.datesWeekdays ? " " : "", span5, humanDesc.weekdays ? " " : "", span6, humanDesc.months ? " " : "", span7, humanDesc.end]);
			}
		}

		// next-date
		var counter = 5;
		if (state.schedule && !state.schedule.errors) {
			var somedate = state.date;
			somedate = new Date(Date.UTC(somedate.getFullYear(), somedate.getMonth(), somedate.getDate(), somedate.getHours(), somedate.getMinutes(), somedate.getSeconds()));
			somedate = indexmodule.nextDate(state.schedule, somedate);
			if (somedate) {
				var ulist = [somedate]
				while (--counter) {
					somedate = indexmodule.nextDate(state.schedule, new Date(somedate.getTime() + 1));
					ulist.push(somedate);
				}
				anotherDiv.innerHTML = ulist.map(function (e, t) {
					return [t ? "then" : "next", " at ", e.getUTCFullYear(), "-", padZero2(e.getUTCMonth() + 1), "-", padZero2(e.getUTCDate()), " ", padZero2(e.getUTCHours()), ":", padZero2(e.getUTCMinutes()), ":00"].join("")
				}).join("<br>");
			}
		}

		// random example
		randomDiv.onclick = function () {
			return takeAction("showNextExample")
		};

		// text-editor
		if (state.selectedPart && state.selectedPart !== prevState.selectedPart && !state.selectedDirectly) {
			var parts = state.text.split(" ").slice(0, state.selectedPart)
			var selLen = parts.pop().length
			var selSta = parts.join(" ").length;
			if (selSta > 0) selSta++;
			setTimeout(function () {
				input.selectionStart = selSta;
				input.selectionEnd = selSta + selLen;
				input.focus()
			}, 0);
		}
		input.className = state.schedule.errors ? "invalid" : state.schedule.warnings ? "warning" : ""
		if (!state.focussed) input.value = state.text;
		input.oninput = function (e) {
			takeAction("inputUpdate", e.target.value);
			takeAction("inputEnter", e.target.value)
		};
		input.onblur = function (e) {
			takeAction("inputBlur")
		};
		input.onfocus = function (e) {
			takeAction("inputFocus");
			takeAction("inputSelect", e.target)
		};
		input.onselect = input.onkeydown = input.onmousedown = input.onkeyup = input.onmouseup = function (e) {
			takeAction("inputSelect", e.target)
		}

		// warning
		warningDiv.style.display = state.schedule.warnings ? "" : "none"

		// part-explanation
		for (var ii = 0; ii < 5; ii++) {
			var el = partExpDiv.children[0].children[ii]
			el.className = "clickable";
			if (state.selectedPart == ii + 1) el.classList.add("active");
			var r = ["minutes", "hours", "dates", "months", "weekdays"][ii];
			if (state.schedule.errors && state.schedule.errors.includes(r)) {
				el.classList.add("invalid")
			} else if (state.schedule.warnings && state.schedule.warnings.includes(r)) {
				el.classList.add("warning")
			}
			el.onclick = (ii => function () { takeAction("selectPart", ii + 1) })(ii)
		}
		partExpDiv.children[1].children[1].style.display = state.selectedPart === null ? "" : "none"
		partExpDiv.children[1].children[2].style.display = state.selectedPart === 1 ? "" : "none"
		partExpDiv.children[1].children[3].style.display = state.selectedPart === 2 ? "" : "none"
		partExpDiv.children[1].children[4].style.display = state.selectedPart === 3 ? "" : "none"
		partExpDiv.children[1].children[5].style.display = state.selectedPart === 4 ? "" : "none"
		partExpDiv.children[1].children[6].style.display = state.selectedPart === 5 ? "" : "none"
		return new Image
	})]
});
content.replaceChild(app.start({}), content.firstChild)
</script>
